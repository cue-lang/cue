# Test the allowEmpty option for glob patterns

exec cue eval
cmp stdout out/eval

exec cue export --out cue
cmp stdout out/export

exec cue vet
cmp stdout out/vet

-- cue.mod/module.cue --
module: "cue.example"
language: version: "v0.11.0"

-- test.cue --
@extern(embed)

package foo

// Test allowEmpty with no matching files
emptyGlob: _ @embed(glob="missing/*.json", allowEmpty)

// Test allowEmpty with matching files
nonEmptyGlob: _ @embed(glob="x/*.yaml", allowEmpty)

// Test default behavior (no allowEmpty) with no matching files should fail
// This is commented out because it would cause the test to fail
// errorGlob: _ @embed(glob="missing/*.json")

// Test allowEmpty with different file types
emptyText: _ @embed(glob="missing/*.txt", type=text, allowEmpty)
emptyBinary: _ @embed(glob="missing/*.bin", type=binary, allowEmpty)

-- x/test.yaml --
a: 1
b: 2

-- x/another.yaml --
c: 3
d: 4

-- out/eval --
emptyGlob: {}
nonEmptyGlob: {
    "x/another.yaml": {
        c: 3
        d: 4
    }
    "x/test.yaml": {
        a: 1
        b: 2
    }
}
emptyText: {}
emptyBinary: {}
-- out/export --
// Test allowEmpty with no matching files
emptyGlob: {}

// Test allowEmpty with matching files
nonEmptyGlob: {
	"x/another.yaml": {
		c: 3
		d: 4
	}
	"x/test.yaml": {
		a: 1
		b: 2
	}
}

// Test allowEmpty with different file types
emptyText: {}
emptyBinary: {}
-- out/vet --
