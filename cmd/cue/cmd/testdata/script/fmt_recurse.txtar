# succeeds when all files are well formatted
exec cue fmt --recurse --check standalone/a/

# prints files that are not well formatted, recursively
! exec cue fmt --recurse --check standalone/b
cmp stdout standalone/b/stdout-golden

# regular files can be passed as an argument with or without files
! exec cue fmt --recurse --check standalone/b/c/not-formatted.cue standalone/b/not-formatted.cue
cmp stdout standalone/b/stdout-golden

# file can be passed via stdin
stdin standalone/stdin/not-formatted.cue
! exec cue fmt --recurse --check -
cmp stdout standalone/stdin/stdout-golden

# directories beginning with _ or . are ignored
exec cue fmt --recurse --check standalone/hidden/

# directories beginning with _ or . are processed when passed explicitly
! exec cue fmt --recurse --check standalone/hidden/_temp/ standalone/hidden/.temp/
cmp stdout standalone/hidden/stdin-golden

# files under cue.mod are ignored
exec cue fmt --recurse --check mod
! stdout .

# files under cue.mod files are processed when passed explicitly
! exec cue fmt --recurse --check mod/cue.mod/
cmp stdout mod/stdout-golden

# exit early if user attempts to use ... patterns
! exec cue fmt --recurse --check standalone/a/...
stderr 'cannot use "..." in --recurse mode'
! stdout .
! exec cue fmt --recurse --check h...
stderr 'cannot use "..." in --recurse mode'
! stdout .

-- standalone/a/formatted.cue --
foo: "bar"
-- standalone/b/not-formatted.cue --
x:    1
-- standalone/b/c/not-formatted.cue --
foo:    "bar"
-- standalone/hidden/_temp/not-formatted.cue --
foo:    "bar"
-- standalone/hidden/.temp/not-formatted.cue --
foo:    "bar"
-- standalone/hidden/stdin-golden --
standalone/hidden/_temp/not-formatted.cue
standalone/hidden/.temp/not-formatted.cue
-- standalone/b/stdout-golden --
standalone/b/c/not-formatted.cue
standalone/b/not-formatted.cue
-- standalone/stdin/not-formatted.cue --
foo:    "bar"
-- standalone/stdin/stdout-golden --
-
-- mod/cue.mod/gen/not-formatted.cue --
foo:    "bar"
-- mod/cue.mod/usr/not-formatted.cue --
foo:    "bar"
-- mod/cue.mod/pkg/not-formatted.cue --
foo:    "bar"
-- mod/cue.mod/module.cue --
module: "example.com"
language: {
	version:        "v0.9.3"
}
-- mod/stdout-golden --
mod/cue.mod/gen/not-formatted.cue
mod/cue.mod/module.cue
mod/cue.mod/pkg/not-formatted.cue
mod/cue.mod/usr/not-formatted.cue
