# Test local path replace directives

# The main module references a dependency that is replaced with a local path.
# The local-dep directory contains the replacement module.

# Test that cue mod tidy works with local replacements
exec cue mod tidy
cmp cue.mod/module.cue want-module.cue

# Test that cue eval uses the local replacement
exec cue eval .
cmp stdout want-eval.txt

# Test that cue export also works
exec cue export .
stdout '"from local replacement"'

# Test that cue vet works (should pass validation)
exec cue vet .

# Test that cue def works (show definitions)
exec cue def .
stdout 'output:'

-- cue.mod/module.cue --
module: "example.com/main@v0"
language: version: "v0.9.0"

deps: {
    "example.com/dep@v0": {
        v: "v0.1.0"
        replace: "./local-dep"
    }
}
-- main.cue --
package main

import "example.com/dep@v0:lib"

output: lib.value
-- local-dep/cue.mod/module.cue --
module: "example.com/dep@v0"
language: version: "v0.9.0"
-- local-dep/lib.cue --
package lib

value: "from local replacement"
-- want-eval.txt --
output: "from local replacement"
-- want-module.cue --
module: "example.com/main@v0"
language: {
	version: "v0.9.0"
}
deps: {
	"example.com/dep@v0": {
		v:       "v0.1.0"
		replace: "./local-dep"
	}
}
