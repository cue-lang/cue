# Test local path replace directives with nested dependencies
# The local-dep module has its own dependencies that must be resolved.

# Test that cue mod tidy works with local replacements that have dependencies
exec cue mod tidy
cmp cue.mod/module.cue want-module.cue

# Test that cue eval uses the local replacement and its dependencies
exec cue eval .
cmp stdout want-eval.txt

-- cue.mod/module.cue --
module: "example.com/main@v0"
language: version: "v0.9.0"

deps: {
    "example.com/dep@v0": {
        v: "v0.1.0"
        replace: "./local-dep"
    }
}
-- main.cue --
package main

import "example.com/dep@v0:lib"

output: lib.value
-- local-dep/cue.mod/module.cue --
module: "example.com/dep@v0"
language: version: "v0.9.0"
-- local-dep/lib.cue --
package lib

value: "from local with deps"
-- want-eval.txt --
output: "from local with deps"
-- want-module.cue --
module: "example.com/main@v0"
language: {
	version: "v0.9.0"
}
deps: {
	"example.com/dep@v0": {
		v:       "v0.1.0"
		replace: "./local-dep"
	}
}
