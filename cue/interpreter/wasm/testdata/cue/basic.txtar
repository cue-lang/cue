# Test basic Wasm functionality that uses core Wasm types.

exec cue eval -E --out cue
cmp stdout out/wasm

-- a.cue --
@extern("wasm")
package p

add: _ @extern("basic.wasm", abi=c, sig="func(int64, int64): int64")
mul: _ @extern("basic.wasm", abi=c, sig="func(float64, float64): float64")
not: _ @extern("basic.wasm", abi=c, sig="func(bool): bool")

x0: add(1, 2)
x1: add(-1, 2)
x2: add(100, 1)

y0: mul(3.0, 5.0)
y1: mul(-2.5, 3.37)
y2: mul(1.234, 5.678)

z: not(true)
-- basic.wasm --
-- out/wasm --
Errors:
x0: cannot call non-function add (type _):
    ./a.cue:8:5
x1: cannot call non-function add (type _):
    ./a.cue:9:5
x2: cannot call non-function add (type _):
    ./a.cue:10:5
y0: cannot call non-function mul (type _):
    ./a.cue:12:5
y1: cannot call non-function mul (type _):
    ./a.cue:13:5
y2: cannot call non-function mul (type _):
    ./a.cue:14:5
z: cannot call non-function not (type _):
    ./a.cue:16:4

Result:
add: add
mul: mul
not: not()
x0:  _|_ // x0: cannot call non-function add (type _)
x1:  _|_ // x1: cannot call non-function add (type _)
x2:  _|_ // x2: cannot call non-function add (type _)
y0:  _|_ // y0: cannot call non-function mul (type _)
y1:  _|_ // y1: cannot call non-function mul (type _)
y2:  _|_ // y2: cannot call non-function mul (type _)
z:   _|_ // z: cannot call non-function not (type _)
