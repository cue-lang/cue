# Check that we can pass to Wasm structs that have holes in them.

exec cue eval -E --out cue
cmp stdout out/wasm

-- a.cue --
@extern("wasm")
package p

cornucopia: _ @extern("struct.wasm", abi=c, sig="func(#cornucopia): int64")

#cornucopia: {
	b: bool
	n0: int16
	n1: uint8
	n2: int64
}

_c0: {b: true, n0: 10, n1: 20, n2: 30}
_c1: {b: false, n0: 1, n1: 2, n2: 3}
_c2: {b: false, n0: -1, n1: 0, n2: 100}
_c3: {b: false, n0: -15000, n1: 10, n2: -10000000}

c0: cornucopia(_c0)
c1: cornucopia(_c1)
c2: cornucopia(_c2)
c3: cornucopia(_c3)
-- struct.wasm --
-- out/wasm --
Errors:
c0: cannot call non-function cornucopia (type _):
    ./a.cue:18:5
c1: cannot call non-function cornucopia (type _):
    ./a.cue:19:5
c2: cannot call non-function cornucopia (type _):
    ./a.cue:20:5
c3: cannot call non-function cornucopia (type _):
    ./a.cue:21:5

Result:
cornucopia: cornucopia()
#cornucopia: {
    b:  bool
    n0: int16
    n1: uint8
    n2: int64
}
c0: _|_ // c0: cannot call non-function cornucopia (type _)
c1: _|_ // c1: cannot call non-function cornucopia (type _)
c2: _|_ // c2: cannot call non-function cornucopia (type _)
c3: _|_ // c3: cannot call non-function cornucopia (type _)
