#Issue: 1940

-- stats.txt --
Leaks:  0
Freed:  447
Reused: 439
Allocs: 8
Retain: 0

Unifications: 287
Conjuncts:    894
Disjuncts:    447

-- in.cue --
#T:
	["a", #T] |
	["b", #T] |
	["c", #T] |
	["d", ...#T]

x: #T
y: #T
z: #T
v: #T

#X: x
#X: y
#X: z
#X: v
#X: #T
-- out/compile --
--- in.cue
{
  #T: ([
    "a",
    〈1;#T〉,
  ]|[
    "b",
    〈1;#T〉,
  ]|[
    "c",
    〈1;#T〉,
  ]|[
    "d",
    ...〈1;#T〉,
  ])
  x: 〈0;#T〉
  y: 〈0;#T〉
  z: 〈0;#T〉
  v: 〈0;#T〉
  #X: 〈0;x〉
  #X: 〈0;y〉
  #X: 〈0;z〉
  #X: 〈0;v〉
  #X: 〈0;#T〉
}
-- out/evalalpha/stats --
Leaks:  3340
Freed:  771
Reused: 771
Allocs: 3340
Retain: 0

Unifications: 2743
Conjuncts:    16921
Disjuncts:    1368
-- out/evalalpha --
(struct){
  #T: (list){
    0: (string){ "d" }
  }
  x: (#list){ |((#list){
      0: (string){ "a" }
      1: (#list){ |((#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "b" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "c" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (list){
      0: (string){ "d" }
    }) }
  y: (#list){ |((#list){
      0: (string){ "a" }
      1: (#list){ |((#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "b" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "c" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (list){
      0: (string){ "d" }
    }) }
  z: (#list){ |((#list){
      0: (string){ "a" }
      1: (#list){ |((#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "b" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "c" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (list){
      0: (string){ "d" }
    }) }
  v: (#list){ |((#list){
      0: (string){ "a" }
      1: (#list){ |((#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "b" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "c" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (list){
      0: (string){ "d" }
    }) }
  #X: (#list){ |((#list){
      0: (string){ "a" }
      1: (#list){ |((#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "b" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "c" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "c" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (#list){
      0: (string){ "c" }
      1: (#list){ |((#list){
          0: (string){ "a" }
          1: (#list){ |((#list){
              0: (string){ "b" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (#list){
          0: (string){ "b" }
          1: (#list){ |((#list){
              0: (string){ "a" }
              1: (list){
                0: (string){ "d" }
              }
            }, (list){
              0: (string){ "d" }
            }) }
        }, (list){
          0: (string){ "d" }
        }) }
    }, (list){
      0: (string){ "d" }
    }) }
}
-- diff/-out/evalalpha/stats<==>+out/eval/stats --
diff old new
--- old
+++ new
@@ -1,9 +1,9 @@
-Leaks:  0
-Freed:  447
-Reused: 439
-Allocs: 8
+Leaks:  3340
+Freed:  771
+Reused: 771
+Allocs: 3340
 Retain: 0
 
-Unifications: 287
-Conjuncts:    894
-Disjuncts:    447
+Unifications: 2743
+Conjuncts:    16921
+Disjuncts:    1368
-- diff/-out/evalalpha<==>+out/eval --
diff old new
--- old
+++ new
@@ -2,19 +2,394 @@
   #T: (list){
     0: (string){ "d" }
   }
-  x: (list){
-    0: (string){ "d" }
-  }
-  y: (list){
-    0: (string){ "d" }
-  }
-  z: (list){
-    0: (string){ "d" }
-  }
-  v: (list){
-    0: (string){ "d" }
-  }
-  #X: (list){
-    0: (string){ "d" }
-  }
+  x: (#list){ |((#list){
+      0: (string){ "a" }
+      1: (#list){ |((#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "b" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "c" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (list){
+      0: (string){ "d" }
+    }) }
+  y: (#list){ |((#list){
+      0: (string){ "a" }
+      1: (#list){ |((#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "b" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "c" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (list){
+      0: (string){ "d" }
+    }) }
+  z: (#list){ |((#list){
+      0: (string){ "a" }
+      1: (#list){ |((#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "b" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "c" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (list){
+      0: (string){ "d" }
+    }) }
+  v: (#list){ |((#list){
+      0: (string){ "a" }
+      1: (#list){ |((#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "b" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "c" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (list){
+      0: (string){ "d" }
+    }) }
+  #X: (#list){ |((#list){
+      0: (string){ "a" }
+      1: (#list){ |((#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "b" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "c" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "c" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (#list){
+      0: (string){ "c" }
+      1: (#list){ |((#list){
+          0: (string){ "a" }
+          1: (#list){ |((#list){
+              0: (string){ "b" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (#list){
+          0: (string){ "b" }
+          1: (#list){ |((#list){
+              0: (string){ "a" }
+              1: (list){
+                0: (string){ "d" }
+              }
+            }, (list){
+              0: (string){ "d" }
+            }) }
+        }, (list){
+          0: (string){ "d" }
+        }) }
+    }, (list){
+      0: (string){ "d" }
+    }) }
 }
-- out/eval/stats --
Leaks:  0
Freed:  447
Reused: 439
Allocs: 8
Retain: 0

Unifications: 287
Conjuncts:    894
Disjuncts:    447
-- diff/todo/p0 --
Structural cycles detected too late.
-- diff/todo/p3 --
The new evaluator, although different, seems to be okay, and arguably better.
Verify. This will be a lot easier to answer once we have structure sharing,
as the answer will be clearer in that case.
-- out/eval --
(struct){
  #T: (list){
    0: (string){ "d" }
  }
  x: (list){
    0: (string){ "d" }
  }
  y: (list){
    0: (string){ "d" }
  }
  z: (list){
    0: (string){ "d" }
  }
  v: (list){
    0: (string){ "d" }
  }
  #X: (list){
    0: (string){ "d" }
  }
}
