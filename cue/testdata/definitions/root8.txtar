-- in.cue --
root: input: foo: {
    metadata: name: *"foo" | string
    id: "id-\(metadata.name)"
    #deps: [string]: _
    #deps: root: {}
    spec: replicas: 1
}
{root.input.foo.#deps}
-- out/eval/stats --
Leaks:  0
Freed:  13
Reused: 4
Allocs: 9
Retain: 4

Unifications: 11
Conjuncts:    20
Disjuncts:    17
-- out/evalalpha --
Errors:
root.input.foo.metadata.name: field not allowed:
    ./in.cue:2:15
root.input.foo.spec.replicas: field not allowed:
    ./in.cue:6:11
root.input.foo.metadata.name: invalid interpolation: field not allowed:
    ./in.cue:3:9
    ./in.cue:2:15

Result:
(_|_){
  // [eval]
  root: (_|_){
    // [eval]
    input: (_|_){
      // [eval]
      foo: (_|_){
        // [eval]
        metadata: (_|_){
          // [eval]
          name: (_|_){
            // [eval] root.input.foo.metadata.name: field not allowed:
            //     ./in.cue:2:15
          }
        }
        id: (_|_){
          // [eval] root.input.foo.metadata.name: invalid interpolation: field not allowed:
          //     ./in.cue:3:9
          //     ./in.cue:2:15
        }
        #deps: (#struct){
          root: (#struct){
          }
        }
        spec: (_|_){
          // [eval]
          replicas: (_|_){
            // [eval] root.input.foo.spec.replicas: field not allowed:
            //     ./in.cue:6:11
          }
        }
      }
    }
  }
}
-- diff/-out/evalalpha<==>+out/eval --
diff old new
--- old
+++ new
@@ -1,17 +1,43 @@
-(#struct){
-  root: (#struct){
-    input: (struct){
-      foo: (struct){
-        metadata: (struct){
-          name: (string){ |(*(string){ "foo" }, (string){ string }) }
-        }
-        id: (string){ "id-foo" }
+Errors:
+root.input.foo.metadata.name: field not allowed:
+    ./in.cue:2:15
+root.input.foo.spec.replicas: field not allowed:
+    ./in.cue:6:11
+root.input.foo.metadata.name: invalid interpolation: field not allowed:
+    ./in.cue:3:9
+    ./in.cue:2:15
+
+Result:
+(_|_){
+  // [eval]
+  root: (_|_){
+    // [eval]
+    input: (_|_){
+      // [eval]
+      foo: (_|_){
+        // [eval]
+        metadata: (_|_){
+          // [eval]
+          name: (_|_){
+            // [eval] root.input.foo.metadata.name: field not allowed:
+            //     ./in.cue:2:15
+          }
+        }
+        id: (_|_){
+          // [eval] root.input.foo.metadata.name: invalid interpolation: field not allowed:
+          //     ./in.cue:3:9
+          //     ./in.cue:2:15
+        }
         #deps: (#struct){
           root: (#struct){
           }
         }
-        spec: (struct){
-          replicas: (int){ 1 }
+        spec: (_|_){
+          // [eval]
+          replicas: (_|_){
+            // [eval] root.input.foo.spec.replicas: field not allowed:
+            //     ./in.cue:6:11
+          }
         }
       }
     }
-- out/eval --
(#struct){
  root: (#struct){
    input: (struct){
      foo: (struct){
        metadata: (struct){
          name: (string){ |(*(string){ "foo" }, (string){ string }) }
        }
        id: (string){ "id-foo" }
        #deps: (#struct){
          root: (#struct){
          }
        }
        spec: (struct){
          replicas: (int){ 1 }
        }
      }
    }
  }
}
-- out/compile --
--- in.cue
{
  root: {
    input: {
      foo: {
        metadata: {
          name: (*"foo"|string)
        }
        id: "id-\(〈0;metadata〉.name)"
        #deps: {
          [string]: _
        }
        #deps: {
          root: {}
        }
        spec: {
          replicas: 1
        }
      }
    }
  }
  {
    〈1;root〉.input.foo.#deps
  }
}
