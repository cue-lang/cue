// Issue 4055: crash variant
// Issue 4056

-- issue4056.cue --
import "strings"

issue4056: full: {
	a: "foo-bar"
	a: _ | error("error message 1")
	if strings.HasPrefix(a, "foo") {
		a: _ | error("error message 2")
	}
}
issue4056: reduced: {
	a: "x"
	a: _ | error("a")
	if len(a) > 0 {
		a: _ | error("b")
	}
}
variant: {
	a: "x"
	a: string | int
	if len(a) > 0 {
		a: _
	}
}
-- pending.cue --
// Be sure to emit errors for uncompleted pending arcs.
err: {
	A: "forty two"
	if A < 100 {B: true}
}
-- out/evalalpha --
Errors:
err: invalid operands "forty two" and 100 to '<' (type string and int):
    ./pending.cue:4:5
    ./pending.cue:3:5
    ./pending.cue:4:9

Result:
(_|_){
  // [eval]
  issue4056: (struct){
    full: (struct){
      a: (string){ "foo-bar" }
    }
    reduced: (struct){
      a: (string){ "x" }
    }
  }
  variant: (struct){
    a: (string){ "x" }
  }
  err: (_|_){
    // [eval] err: invalid operands "forty two" and 100 to '<' (type string and int):
    //     ./pending.cue:4:5
    //     ./pending.cue:3:5
    //     ./pending.cue:4:9
    A: (string){ "forty two" }
  }
}
-- out/compile --
--- issue4056.cue
{
  issue4056: {
    full: {
      a: "foo-bar"
      a: (_|error("error message 1"))
      if 〈import;strings〉.HasPrefix(〈0;a〉, "foo") {
        a: (_|error("error message 2"))
      }
    }
  }
  issue4056: {
    reduced: {
      a: "x"
      a: (_|error("a"))
      if (len(〈0;a〉) > 0) {
        a: (_|error("b"))
      }
    }
  }
  variant: {
    a: "x"
    a: (string|int)
    if (len(〈0;a〉) > 0) {
      a: _
    }
  }
}
--- pending.cue
{
  err: {
    A: "forty two"
    if (〈0;A〉 < 100) {
      B: true
    }
  }
}
