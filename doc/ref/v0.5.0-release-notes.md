# v0.5.0 release notes

Release commit: d780488159bd082f9f9d027ab42dd4d9b5d95d5e

---

This release focuses on changes to the implementation of comprehensions, the algorithm for detecting cycles in CUE, and the reimplementation of `let` comprehensions as fields.

Also included are a number of bug fixes and changes to help the [KubeVela project](https://kubevela.io/) upgrade off CUE v0.2.2 to the latest release. v0.5.0 is the first release since v0.4.3 back in April 2022. It has been a long time in the making, and is comprised of 277 commits.

It is worth noting that we do not plan nor wish for such long gaps between releases. For more details on upcoming releases and steps we are taking to increase release cadence as well as our confidence in each release, please see [this discussion](https://cuelang.org/issue/2335).

As a reminder: users can register their projects with `unity`, our regression and performance testing setup. `unity` is used to ensure that a project's CUE evaluations do not unexpectedly stop working, or regress in terms of performance. `unity` continues to catch multiple issues with each release. Adding your project to `unity` not only guarantees that we will not break your tests (if we do, we will work with you to fix your CUE code), but it also helps to improve the quality of each CUE release. We are currently in the process of releasing Unity as a GitHub App on the public Marketplace. [Sign up](https://forms.gle/cqsdoNZQnQ1efGJy5) to receive updates; we will be in touch as soon as the GitHub App is ready.

Thank you to @djosephsen, @joaopapereira, @mpvl, @mvdan, @myitcv, @qequ, @rogpeppe, @rytswd, @satotake, @spachava753, and @tmm1 for contributing to this release!

## Project-level changes

Various CI-related changes have been made to simplify and streamline the GerritHub-based CI setup across the various CUE repositories. A common `base` package is vendored into each repository and used as a template for GitHub workflows and other configuration. For those interested in studying the setup, please see the files beneath [`internal/ci`](https://github.com/cue-lang/cue/tree/a1d9054ffa5b292763538a3fa6cf057a062a145d/internal/ci).

This release drops support for `go1.16.x` , `go1.17.x` and `go1.18.x`, is tested against `go1.19.x` and `go1.20.x`, and is built using `go1.20.2`.

Our dependency on `github.com/rogpeppe/go-internal` is upgraded to `v1.9.0` and various `testscript`-related improvements have been made to CUE's tests.

[GoReleaser](https://goreleaser.com/) has been upgrade to v1.16.2 as part of the release workflow. In a related change, [CL 546920](https://cuelang.org/cl/546920) moves us to a CUE-based source configuration for GoReleaser. This allows us to define the concept of 'latest', state which indicates whether we should perform the homebrew release and the Docker manifest latest steps. This fixes a long-standing bug whereby homebrew taps and Docker images were created for the latest release, regardless of whether that was a pre-release, or indeed a patch version of a non-current minor version.

As of [CL 547507](https://cuelang.org/cl/547507), CUE build artefacts published on GitHub are entirely reproducible, thanks to Go's [support for reproducible, verifiable and verified builds](https://research.swtch.com/vgo-repro).

## Encoders

When `cue import`-ing YAML, the `-R` recursive flag now only recursively interprets text as YAML if it contains a newline [CL 536902](https://cuelang.org/cl/536902).

## API

Various APIs have been transitioned to drop use of the deprecated `cue.Runtime` type, as well as migrating away from `cue.Instance` via `cue.InstanceOrValue`.  Some use of these deprecated types remains: [#1035](https://cuelang.org/issue/1035), [#1735](https://cuelang.org/issue/1735), [#1806](https://cuelang.org/issue/1806). These will be tidied up in later releases as the API surface matures towards v1.0.0.

The `cue` package now supports `InlineImports` for `Value.Syntax` [CL 541561](https://cuelang.org/cl/541561). This leverages new support within the internal exporter to creating self-contained CUE. This change also deprecates `Value.ResolveReferences()`.

Package `cue` adds `Selector.Type` to make it easier to pull out selector-specific information from a selector (for example, it makes it possible and cheap to retrieve the unquoted string label from a regular field selector) [CL 542738](https://cuelang.org/cl/542738).

Package `cue` adds `Value.BuildInstance()`. If a `cue.Value` exactly represents a package, `BuildInstance()` returns the build instance corresponding to the value [CL 542769](https://cuelang.org/cl/542769).

`cue/stats` is introduced as a new package for getting CUE operation statistics.  The functionality is hoisted from `internal/core/adt`, but the package should for all practical purposes be seen as a new implementation. The stats have been aggregated as experimental functionality to the `tools/flow` package.

[CL 546763](https://cuelang.org/cl/546763) disallowed deprecated language features in the Go API. These features had long been deprecated in `cmd/cue`.  This means that API operations will now fail on deprecated features whereas before they were handled in compatibility mode. The `parser.FromVersion` feature can be used to reenable these deprecated features.

## Language

This release does not introduce any language changes. [CL 537264](https://cuelang.org/cl/537264) made some minor adjustments to the language specification to improve readability.

[CL 541457](https://cuelang.org/cl/541457) removes support for re-writing of old-style `let` declarations. This had already been deprecated for a long time and this change was made to enable support for aliases of embeddings.

## Core evaluator

### Per-field comprehensions

One of the major changes introduced in this release is how comprehensions are handled. [CL 529524](https://cuelang.org/cl/529524) move the evaluator to a model of per-field comprehensions.

Comprehensions are expanded `for`, `if`, and `let` clauses that yield zero or more structs to be embedded in the enclosing list or struct.

CUE does not allow cyclic dependencies between comprehensions if they result in an ambiguous set of fields.  It does allow cascading insertions as in:

```
a?: int
b?: int
if a != _|_ {
    b: 2
}
if b != _|_ {
    c: 3
    d: 4
}
```

The way this works is that for fields with a fixed prefix path in a comprehension value, the comprehension is assigned to these respective fields.

More concretely, the above example is rewritten to:

```
a?: int
b: if a != _|_ { 2 }
c: if b != _|_ { 3 }
d: if b != _|_ { 4 }
```

where the fields with if clause are only inserted if their condition resolves to true. Note that this is not valid CUE; it may be in the future.

With this rewrite, dependencies in comprehension expressions are handled analogously to other expressions.

Note that a single comprehension may be distributed across multiple fields. The evaluator will ensure, however, that a comprehension is only evaluated once.

Analogous to reference cycles, as of [CL 544129](https://cuelang.org/cl/544129) we allow comprehensions to use the struct in which they are defined as source, as long as they do not introduce new fields, which would alter the source on which they iterate.


### Reimplementation of cycle detection

The new algorithm is inspired by the cycle detection used by Tomabechi's [^Tomabechi] and Van Lohuizen's [^VanLohuizen] graph unification algorithms.

Unlike with traditional graph unification, however, CUE uses references, which, unlike node equivalence, are unidirectional. This means that the technique to track equivalence through dereference, as common in graph unification algorithms like Tomabechi's, does not work unaltered.

The unidirectional nature of references imply that each reference equates an exact copy of the value it points to. This renders the original approach of node-pointer equivalence useless.

The new algorithm, a variant of Tomabechi's and Van Lohuizen's algorithm, looks at references equality on conjuncts, instead of node equality. This simplifies the accounting and allows for far simpler and precise accounting when using references instead of the traditional node equivalence.

#### More background info on cycles

We have to define when a cycle is detected. CUE implementations MUST report an error upon a structural cycle, and SHOULD report cycles at the shortest possible paths at which they occur, but MAY report these at deeper paths. For instance, the following CUE has a structural cycle:

```
f: g: f
```

The shortest path at which the cycle can be reported is `f.g`, but as all failed configurations are logically equal, it is fine for implementations to report them at `f.g.g`, for instance.

It is not, however, correct to assume that a reference to a parent is always a cycle. Consider this case:

```
a: [string]: b: a
```

Even though reference `a` refers to a parent node, the cycle needs to be fed by a concrete field in struct `a` to persist, meaning it cannot result in a cycle as defined in the spec as it is defined here. Note however, that a specialization of this configuration _can_ result in a cycle. Consider

```
a: [string]: b: a
a: c: _
```

Here reference `a` is guaranteed to result in a structural cycle, as field `c` will match the pattern constraint unconditionally.

In other words, it is not possible to exclude tracking references across pattern constraints from cycle checking.

It is tempting to try to find a complete set of these edge cases with the aim to statically determine cases in which this occurs. But as Carpenter [^Carpenter] demonstrates, it is possible for cycles to be created as a result of unifying two graphs that are themselves acyclic. The following example is a translation of Carpenters example to CUE:

```
y: {
	f: h: g
	g: _
}
x: {
	f: _
	g: f
}
```

Even though the above contains no cycles, the result of `x & y` is cyclic:

```
f: h: g
g: f
```

This means that, in practice, cycle detection has at least partially a dynamic component to it.

The [language specification](https://cuelang.org/docs/references/spec/) contains a higher-level and more complete overview of structural cycles.

[^Tomabechi]: https://aclanthology.org/C92-2068
    Hideto Tomabechi. 1992. Quasi-Destructive Graph Unification with
    Structure-Sharing. In COLING 1992 Volume 2: The 14th International
    Conference on Computational Linguistics.

[^VanLohuizen]: https://aclanthology.org/P00-1045/
    Marcel P. van Lohuizen. 2000. "Memory-Efficient and Thread-Safe
    Quasi-Destructive Graph Unification". In Proceedings of the 38th Annual
    Meeting of the Association for Computational Linguistics, pages 352–359,
    Hong Kong. Association for Computational Linguistics.

[^Carpenter]:
    Bob Carpenter, "The logic of typed feature structures."
    Cambridge University Press, ISBN:0-521-41932-8


### Reimplementation of `let` comprehensions

[CL 543362](https://cuelang.org/cl/543362) made a change to `internal/core` to reimplement `let` comprehensions as fields. This makes it easier to track context as `let` comprehensions then follow the same paradigm as fields. It also allows debug information to be shown as to where lets are added in the tree. This change was accompanied by number of others that refined the approach.

### Self-contained export

`internal/core/export` now implements an algorithm for generating self-contained CUE on export, an option that can further be refined by asking the exporter to inline imports.  These internal changes manifest in changes to `cue def` and `cuelang.org/go/cue` that are described elsewhere.

### Other changes

[CL 545897](https://cuelang.org/cl/545897) started tracking stats within the core CUE tests. This book keeping helps to spot likely regressions in performance early by collocating the stats with the CUE that is being evaluated.


## Builtins

In the `strconv` package, `strconv.FormatInt` and `strconv.FormatUint` now support arbitary-precision format; see [CL 538512](https://cuelang.org/cl/538512).

[CL 545898](https://cuelang.org/cl/545898) improved the error messages for `pkg` builtins, by including the path in error in many cases, and passing a wrapped message for `encoding/yaml`.

[CL 546237](https://cuelang.org/cl/546237) allows incomplete `list.MinItems` constraints. Before it either returned `false` or `true`, ignoring that making a configuration more specific might still satisfy `MinItems` later on. [CL 546238](https://cuelang.org/cl/546238) made a similar change for `struct.MinFields`.



## Tooling layer

Standard input is now parsed correctly in `cue cmd`-declared command tasks; see [CL 541898](https://cuelang.org/cl/541898).

## `cmd/cue`

Version control system (VCS) information is included in `cue version` as of [CL 540297](https://cuelang.org/cl/540297). The Go version used to build `cmd/cue` is included as of [CL 549302](https://cuelang.org/cl/549302).

`cue def` now supports an `--inline-imports` flag which resolves imports to print a self-contained version of the command input. For example, given the `txtar` input:

```
-- cue.mod/module.cue --
module: "example.com/a"

-- in.cue --
package a

import "example.com/a/pkg"
import "list"

v: pkg.v

-- pkg/pkg.cue --
package pkg

v: { x: 3, y: x }
```

The running `cue def --inline-imports in.cue` will give:

```
package a

import "list"

v: {
	x: 3
	y: x
}
```

[CL 546243](https://cuelang.org/cl/546243) fixed a long-standing bug whereby the `--ignore` errors flag was not observed by `cue eval`.

## Changelog

- internal/ci: fix cache eviction by @myitcv in a1d9054ffa5b292763538a3fa6cf057a062a145d
- internal/ci: address review feedback from CL 551352 by @myitcv in af01db1892e650a55d62d7423fe96732d6fb911d
- internal/ci: allow trybot workflows to be workflow_dispatch-ed by @myitcv in 22156efdb892e80b7e92b4a2785ceb831470abc1
- internal/ci: refactor CI workflows by @myitcv in a4403eb12b04c6cb9ca19ac03561199912fc66e5
- internal/ci: remove hard-codings in base package by @myitcv in 0eaee7137e10cf1ca23ab263d872dcaf0fa97aeb
- internal/ci: move evict_caches to base by @myitcv in 584b21e968ba7941ff4a03d5784fd37dcd9cca06
- internal/ci: remove mention of matrix and runner from base by @myitcv in 7c07680633f8644441d9ae80f150ac5a471abd8a
- internal/ci: remove trybot from push branches by @myitcv in 9f3af8f084f97838999f6cd5bba545054fba85f1
- internal/ci: refactor base caching pattern by @myitcv in 390bca5ce528e3a6408171b79961508f00e56f12
- internal/ci: drop pullThroughProxy step by @myitcv in a14fbf49856399c7a6737e1495f7d8dde994be88
- [release-branch.v0.5] internal/ci: bring inline with be0601bf by @myitcv in f4d04a7e5dc569836900c77b6aa4c26f20fcc9d1
- internal/ci: bump pinned version of Go for releases by @mvdan in 374a2cc382856da74e5634341e3fbb2fd9fa84d1
- internal/core/adt: revert fix for 2209 by @mpvl in c0421b44e58cedad9200162a6fb6fae065da2d2b
- internal/core/adt: fix possible infinte loop for API usage by @mpvl in 1ce91202faf3d4de930e1c75c491c332c7b9d11a
- internal/core/adt: fix regression in comparing to bottom by @mpvl in 87c79efa8f37e1441b8ea67cff0bf5027bf1daaf
- internal/core/adt: remove unnecessary check by @mpvl in 28321f6b49947b993823fb445835f560f0464b69
- internal/core/adt: detect closed lists as fatal errors by @mpvl in 5d42c6cee285c44bb4af1cda5b31227f65364c99
- internal/core/adt: sharpen condition for scalar setting by @mpvl in 3ba76baf9b432e15f110c49be701a5d0600c2412
- internal/ci: fix goreleaser in non-snapshot mode again by @mvdan in 576d0e461a990ddcdab9da7a10375a1c6d87a865
- internal/core/adt: fix 2235 by @mpvl in ca411dedecdf08f2d0b99931c61a6d37ea93c985
- internal/core/adt: add tests for 2235 by @mpvl in 89693e1ff31881d90500db4d34b05c7685575d76
- cmd/cue: include Go in the version command by @mvdan in 9b1f248845fabfda2ed70cc3c1c823baef5da69f
- internal/ci: fix and test the release workflow on branches by @mvdan in 63749fe7d1fc40011564d54da9826050fd5a6239
- cmd/cue: add evaluator stats support by @mpvl in d573e0c2f0419f3a32e9d7bc1f3000cc365a240d
- cmd/cue: add tests for issue 345 by @mpvl in 352a7363b1b22ed4490d328bbc9275bf4dd2b779
- internal/core/adt: filter more disjunctions by @mpvl in 5a6bd1910821112123897c2b553b848c15f6eae2
- internal/core/adt: add tests for 2209 by @mpvl in 6b45d7e520a8e1b0f9ba287967fdb8b059e49fdc
- internal/core/adt: improve mechanism for conjunct insertion by @mpvl in 887f56497cbc2178e9cb1e9be78d8abae78ea0cd
- internal/core/adt: add tests for conjunct insertion by @mpvl in 81e4cba186c65ada5018d71c80bf63ce00bf08e7
- internal/core/adt: only set scalar if not already defined by @mpvl in f23e3d565c499c1a220b94edcbc18f83c1438836
- github: bring the bug report template up to date by @mvdan in b75fdc8bf307185c20b9107082ce0d8c205c36f5
- internal/ci: make github CLI shell invocations safer by @mvdan in 94765d6a9756fc83be553779fef8e1faaba226b5
- internal/core: clone let upon use of for var references by @mpvl in 3a79e96aa6bb406475e7d121d65caa87ae463ce4
- internal/core/debug: change notation for "multi" lets by @mpvl in fd05908d444bd4132b2137cd3aa84918c4366227
- internal/core/adt: don't add errors to "void" arcs by @mpvl in 0b41dbb875537a04fce46a4a56f7b625fa2cc6f1
- cue/testdata/benchmarks: add benchmark for let key by @mpvl in a8d7c59f176a28936cc6d8231050630ec5498f19
- internal/core/adt: evaluate expressions directly by @mpvl in 8fb13d4c31d145b54c203ebbd1a69e84db2db35a
- internal/core/eval: node should not finalize itself mid flight by @mpvl in 9d27e0d992ae50da72244c2210252cb4248a8048
- cmd/cue: don't panic in vet if a schema has incomplete errors by @mvdan in f6841d1f026cefd964c1f5b2e0e331ff8e8ce9db
- internal/ci: deploy [tip.cuelang.org](http://tip.cuelang.org/) via repository_dispatch by @myitcv in 632cc622744b2a17db22932c8c7319a3e6b5e4fb
- internal/ci: enable push_to_tip_trybot by @myitcv in fe692c55eccb1efcd6b5ea181430d38479c4f4e7
- internal/ci: apply various CI-related changes from [cuelang.org](http://cuelang.org/) repo by @myitcv in 4eaa9465d0287a7cf9de0ca73189d6084449ba1e
- internal/ci/goreleaser: actually make builds reproducible by @myitcv in 45aa5c093e71660b341fa15a8a41d77eb64a0121
- internal/ci/goreleaser: make builds reproducible by @myitcv in 16edb00a2504c92b09e43721f96a166109b1c2a4
- cue/export/extract: fix comments with comprehensions by @mpvl in 959dc46d5ac976bd2fc9b6f4bf0cd596c00fd0c5
- internal/core/adt: don't evaluate inlined structs prematurely by @mpvl in 45ff2823f7d071b803a8b55d96ad4bcf7c1647ef
- internal/core/adt: add tests for issue #2163 by @mpvl in a9f4fc3ec3b9e7f0f91df16a86b2295a3a66e546
- internal/ci: review follow-up changes to goreleaser_tool.cue by @mvdan in 7ea44a3f045decf221f86fbd91c9abd566fa6680
- internal/ci: switch to CUE based definition for goreleaser by @myitcv in 79a476b8c16c8900ff84811de1f2c8e769e8ebab
- internal/ci: import for current goreleaser configuration by @myitcv in e69c5174ae19e8842bc34af1553189dd7a48e4b2
- internal/ci: upgrade to later GitHub workflow schema by @myitcv in f036b34ca756c2afd061ef9a1a763f670092b048
- internal/ci: upgrade to latest GoReleaser version by @myitcv in 248f2b30c8702c9b5ed012e6ac0961c109d69cb3
- goreleaser: formatting changes in Yaml file by @myitcv in e93b5ed61fc6998ad8b9b1bf5f50ab94b57e5e26
- internal/ci: use newer versions of the docker github actions by @mvdan in f56600dcb932fb5bef421a43ac32c8cd260f4fc0
- internal/core/adt: base error mode on requested state by @mpvl in 214e11278cbe09e8ae1cbeff83bb7e61cfe1894c
- internal/core/adt: only set validation result when safe by @mpvl in 88857e0058cf744dcf0506da39d75eb946af1976
- internal/core/adt: pass desired state to more functions by @mpvl in 55cdb7420b791aeb2b63413aeabe1bcd3dae57ba
- internal/core/adt: pass more state around by @mpvl in 3dfeb4112ffcd9d3267c2dc8e0950e3f095bb210
- internal/core/adt: pass state to validation by @mpvl in 0954c6f8888daf741e7d40860db2f165af05b6d4
- internal/core/adt: pass state to evaluate by @mpvl in 7d5022852075821ea04d21854b372ee3bb73a42b
- internal/core/adt: avoid duplicate insertion of conjuncts by @mpvl in d341814a6e0fe9eef963c26956527c0b75e85286
- internal/core/adt: tighten uniqueness of conjuncts by @mpvl in a68c6ce64f3b69ef09fe91aca7c4c067101bda73
- cue/parser: disallow deprecated language features in API by @mpvl in 67ace837da2b061c05be7f1189abb0e96107a2f2
- internal/core/adt: remove nested comprehension special casing by @mpvl in 3c0b2ecd089da711f3fb1a9b9f3109a36ccdce1c
- README: fix the stale GitHub Actions badge by @mvdan in 4fee020034c66d74c2a0d68d56c72f7728bd8ea3
- internal/core/adt: disambiguate let cache by @mpvl in 43fc68115618c5070357dd482530a42ba208e4b1
- internal/core/adt: update stats to fix build breakage by @mpvl in a800e6fadcfd2a30bda3f1ef330574c11c292499
- internal/core/adt: merge Conjunct and Partial processing by @mpvl in 121894c5c4616bc972b60e484989cab321b75800
- internal/core/adt: remove assertion by @mpvl in 129c3439c62fd3ee3165bd2c1e3e64198fe066b1
- internal/core/adt: add test cases for issue 2119 by @mpvl in 2499719dc992d8182f5669c829735623e3826d8e
- internal/core/adt: add tests related to Issue #2113 by @mpvl in 525648d853bb7dbb9187bff2649c03db8d865be8
- internal/core/adt: evaluate let fields earlier in comprehensions by @mpvl in e5fb5afcd1a935f8d2ce662a9267d9660f4771cd
- internal/core/adt: detect cycles in patterns by @mpvl in c04813590f244fab54ce69a08df1ddf7f95b0993
- cue: update Value.Source doc comment by @rogpeppe in 45ce7a3652a39c81593b069ad56cbe4589f00c01
- tools/flow: add debug support via CUE_DEBUG_TOOLS_FLOW by @myitcv in d85f950102eef401adfad76f56d01d776e3537b9
- internal/core/adt: fix comprehension cycle regression by @mpvl in 32bfffd0aa538d63757efeef393bc37a06c8c9a4
- internal/core/adt: add tests to address regressions by @mpvl in 82bf03685cf19981bbd2641fdc2e4c71924359c4
- internal/core/adt: split some tests into files by @mpvl in 69ee994fd01d14e97d42f15a1056e0d0aba452ec
- infra: upgrade goreleaser by @myitcv in 7bdeb14af88c7bb78cae4cb000341b679ac11849
- doc: simple whitespace change to track down GerritHub replication issue by @myitcv in 1bb7fed608fd273b3d9c581074908e022cf76231
- cmd/cue: fix --ignore errors flag by @mpvl in ab14c8681d666b9ecc2092546e94946d488e8ad0
- pkg/list: make error of MaxItems consistent with MinItems by @mpvl in c5fbbabd6bde15901a845e3d9d69b0d134f0b4d9
- pkg/struct: fix MinFields analogously to MinItems by @mpvl in 849371d983e827cbe7c58bcf02f83ad65b935542
- all: remove mistakenly added file by @mpvl in 68445d839bf0d62aa807388d4ec94007ef7c6820
- internal/core/adt: fix panic using builtin validators by @mpvl in 9bbc14bc7bce485af1bb3c1b79b87a01c03e3d30
- internal/core/adt: don't bump state by @mpvl in b18d00f5369c6e42f500ec46218dedf9ef7a2100
- internal/core/adt: prevent early error assignment by @mpvl in 27b6e87efbde0d14b31eeb59943ff79b90fb92ec
- internal/core/adt: relax cycle tracking by @mpvl in 9c761dd5571d3f34bde4a9992e733f1415f0c071
- pkg/internal: allow incomplete list.MinItems by @mpvl in 354f4e6fee32792386d7187079a3c0222248afbc
- internal/core/adt: add tests for #2052 by @mpvl in 6162b95f494dad6eedb336a38e8b96129c6fd903
- internal/core/adt: fix redundant errors in calls by @mpvl in 959605e053076884efb689583c572ebe4f074728
- drop support for Go 1.17.x ahead of the v0.5 release by @mvdan in 0292e7f4c3eeabd9e9cf4971d96157ac00519c2b
- internal/core/adt: improved reporting disjunction errors by @mpvl in a8d68ad05ab615bafacc07d0ccaf12ba0d9f669a
- internal/core/adt: avoid uninformative cyclic error by @mpvl in 1d8d8ffea6b95e2b0d555bd6999004268eb14d16
- internal/core/adt: remove over-aggressive deduplication by @mpvl in 74b4288a36ae47acbd1b09a24ca86cda7f0f85ef
- internal/core/adt: fix error checking bug by @mpvl in 28088ac8e83ee123e329663a533b0b22f47c4c95
- internal/core/adt: add cycle detection for alt evaluation path by @mpvl in 4eb2280f2dca883b2db7a7cde2937fed8cd1caa6
- internal/core/adt: errors in let expressions are okay by @mpvl in 30b2007b58507c3e4c3b6f21d88f9e3a2df1d78e
- pkg: improve error messages by @mpvl in fa36be403849715004c2d143afb3e77a29ac6238
- internal/core/adt: add stats by @mpvl in e2a0ef60402692f9f08690fb55fa24aa53367062
- internal/core/dep: handle recursive lets by @mpvl in 1d8663e67324a7c9623b8c1562936db9a0598172
- internal/core/adt: fix comprehension bug by @mpvl in 87347d212f153094980e507fe1c78185d3b8382c
- internal/core/adt: remove redundant state change by @mpvl in 24576a0ff2af6929d43394df9deb7e2e9f3dfee2
- cue/ast: fix StructLit.End by @rogpeppe in b23ece37510a9043871c8d5dac035ddd2032a206
- internal/third_party/yaml: fix float parsing by @rogpeppe in a4941ed62de064238bb7dd3cb343ab9e4e87f008
- internal/third_party/yaml: slim down API by @rogpeppe in 794d078602d62d2496c9783554a6bb815ae75ef5
- doc/ref/spec.md: binary literals support `_` separators as well by @spachava753 in 712d8c62644dfdab62c01d68314c65eb12300be7
- internal/core/adt: recursively pre-expand comprehensions by @mpvl in 102b0341dae9420a6cd125678c96b3cd8c32ed2f
- internal/core/adt: represent comprehension clauses as list by @mpvl in b3bcc7aaf3d0e6074a4cad6e725113cf2aa36640
- internal/core/dep: remove useless code by @mpvl in 309b9655d60fea3cfde50004650d8742c37e696e
- internal/core/adt: fix cycle detection bug for lets by @mpvl in f2b94794ad54347b92a97a8c69ae3f931efd975e
- internal/core/adt: allow self-referential comprehensions by @mpvl in f1daf4b823aa7fedc668add92686dbcbf0141909
- internal/core/adt: update state constants and docs by @mpvl in e4f4900c5728d22815a71ca1fdcbbe86d8e91d83
- internal/core/adt: add conjuncts to dynamic list as well by @mpvl in 637a3258c48923c7120cf4ec4d88fb7611879763
- internal/core/adt: report cycle error in comprehension source by @mpvl in 6668dc8e1f94477ec6378f309ba8b8f498f17de5
- internal/core/adt: rename test by @mpvl in f30a8e71e6dfc4014ed717edb9b78b0cf73f3cba
- internal/core/adt: add IsDefined to filter out void arcs by @mpvl in 2ae37df09d57c432f865338e1ec4e86de2070ba9
- internal/core/adt: fix closedness regression by @mpvl in ed4f8850d35a6ca4012c16db0cbf42b6e2d52af0
- internal/core/dep: fix comprehension environment binding by @mpvl in 6824f7d3cb3c4e4fa5e58359c051c207aeada9a2
- deps: bump [golang.org/x/text](http://golang.org/x/text) dependency by @joaopapereira in dd1169c686c9e45358fa87fcdb9530fe3f6a799f
- .gitignore: add .DS_Store by @mpvl in 79d80efc288208410f77d47ae9aedd37e106d84b
- internal/core/adt: fix broken let lookup in embedded scalars by @mpvl in cad3f2394c591d95747d0d965a7d48638b17bf01
- internal/core/adt: optimize cycle detection for disjunctions by @mpvl in 830b138ebfb6b81ecc5ec2bbcc14adaf7665d756
- internal/ci: test and release on Go 1.19.x by @mvdan in fe50dff0dce87c9a8bfa6f15f8df64b9172d2533
- internal/core/adt: remove problematic Ref deletion by @mpvl in 75189525aabd2bcf2d8738855b187adb4713a393
- cue/testdata/benchmarks: add stats by @mpvl in 3bcf4a477733ea2a754837df1b0ba7d1cedce0a2
- encoding/gocode: encode hex consistently like Go 1.19+ by @mvdan in f5c3e4eeb64ad6e4c3a2a33f0152ef00a58773f9
- doc/tutorial/kubernetes: mark both tests as long by @mvdan in 06aaef66df030ff0e63fb633847850008d558fe4
- internal/core/adt: add test for issue 1837 by @mpvl in 839e33b3dc64ca2234b54a1fa8451650eb3a18f5
- internal/core/adt: make some errors semi-permanent by @mpvl in 4a3a494e8db538f8689ff9c0d3a882c93cafcc59
- internal/core/adt: reduce size of ErrorCode by @mpvl in 53dfffae81d2e91494e0dbc03a2565debf50a90e
- internal/core/export: fix crash in dynamic fields by @mpvl in ad253ed099e94ddcffd07e6f73a76735a96cfaf8
- all: apply and follow Go 1.19's gofmt by @mvdan in 519d326df357904f95bc704d48d594a3f26c2319
- internal/core: implement let as fields by @mpvl in 36bd6562f7ba43afbd850abfa565da5576117154
- pkg: reuse pkg/gen to generate package godocs by @mvdan in df148ee6b6133e0466f7964eec027f2e0349cdbe
- internal/core/adt: eliminate disjuncts for incomplete errors by @mpvl in c556a196ad43bcd0ff4fad4f938cabc03ee5e433
- doc/tutorial/kubernetes: only run as a long test by @mvdan in 6551ea5dd7890757afdbf6823443357bc96f4e5f
- internal/core/adt: fix test by @mpvl in d3959ebce9168f9b922e72e711bac71532e5bd44
- internal/core/adt: add tests for let by @mpvl in 7c7056cd8964d9cb8f4da1c021165630ab091d49
- internal/core/compile: prepare for let change by @mpvl in 739713c849262af5d5681fbd5dab5aa77787d738
- internal/core/...: fix various attributes printing issues by @mpvl in 82933ad1f9ef0dd68aaa8c1a52d8f56a3ad7f4e5
- internal/core/adt: remove StructInfo for unused structs by @mpvl in c89ab8b4534144edd9e4313666a7967cb40270d5
- internal/core/compile: add missing import in test by @mpvl in be9cc0dfe2efcc9ae76f84f0e21afd83b9bd1349
- internal/cuetxtar: add method for getting a single instance by @rogpeppe in e5f21dbb163c8b864dc1e518dc86e16d8aa0bbf9
- internal/filetypes: not a file extension if the file starts with a dot by @rogpeppe in db0897b6b21f16d4dcd3503af51e2f2592b5cc03
- internal/core/adt: defensive use of CloseInfo by @mpvl in 9e9786e93b63af979d9f105a12c8519a6216e56f
- internal/filetypes: fix TestParseFile tests by @rogpeppe in 3290797d2b2b1f41355b6a06d5e9efccf2509a7c
- internal/cuetxtar: improve docs by @rogpeppe in d2250b9bc1870a2488ee3f33b4e8e4fd0561a5f3
- encoding/gocode: be resilient to Go string literal changes by @rogpeppe in 1cfb57cd7485c72d155968cf9a054ac91c6119c7
- doc/tutorial/basics: make test scripts run again by @mvdan in 6cb877ecdd50ec5a4141b4b5a4e0a50b5ac06c60
- encoding/openapi: update API by @rogpeppe in 74566cff8b973ffa3833ec2f217833f182571c13
- cue/stats: new package for getting operation statistics by @mpvl in 535d188e024a150de6093a18bee639915e612394
- errors: make Errors and Print respect wrapped errors by @rogpeppe in 4007775eb33da64db9dd38f43da31b39d1bbfc58
- internal/core/path: package for Selector to Feature conversion by @mpvl in 4c9d0ac139d02d5ac3208d3268af4ee92916d70f
- cue: tweaks to selector API by @mpvl in cd27b125bb2e70bc8075d083aebde0a9f8efe940
- cue: add Value.BuildInstance method by @rogpeppe in a552c1fce216865669537591e182add604677252
- encoding/yaml: be clearer about the role of the src argument by @rogpeppe in 351a9fbaa8aa7f0482e162f20c4d5a49165b15f9
- internal/core/adt: fix cycles in evaluation by @mpvl in ac1121593d7ab5b3beff5b36f7e77e1cb3fab0c1
- internal/core/adt: tighten structural cycle detection by @mpvl in f8e363e55bbd91a3ca56b3620edfa41854bc5269
- internal/core/adt: tighten structural cycle detection by @mpvl in 68152ec4619731d1d718757571d238eaf94516f8
- internal/core/adt: fix spurious cycle for inline recursion by @mpvl in c99704419ffce8b90f9c60c0148152e04d044ec6
- internal/core/adt: fix issue with references cycles by @mpvl in cd4bf2b46c3234ba2e6ba649df8633efd0483eb7
- internal/core/adt: some fixes to structural cycle detection by @mpvl in 8133f552636371d32edf9c972e135bc274184c66
- internal/core/compile: fix aliases to dynamic fields by @mpvl in 353833c0a26a411febdacf8096e378ecbd214e5e
- cue: add Selector.Type API by @rogpeppe in 8e8f1cfff0aeed7575cd362336da134e2890a311
- cue/load: deterministically sort CUE files when loading by @mvdan in 295786ef80b0dfd14eacc66f4c0babbbfc832f99
- internal/core/adt: count conjuncts by @mpvl in 1a129169283720446cc3cb279f7e8b7adf282bca
- internal/core/adt: finalize arcs that are almost done by @mpvl in 8ee11275c50edf03df202f86cf7b0d0087da0de4
- internal/core/adt: remove redundant line by @mpvl in 37ee967c3abff6f18e0a7de3e1558e4af40957f4
- internal/core/adt: clean up some span logic and add a comment by @mpvl in ce30e6728aa80c9e21e04863107b4cc19263672e
- internal/core/adt: move Label for better bin packing by @mpvl in e398e10f2359b35b88f532113468578fe21035ab
- internal/core/adt: clean up some closedness code by @mpvl in 9e15ca15750c6efe53c36c6b64684cafcea1e220
- internal/core/adt: fix spurious child error by @mpvl in 830847bf692effdc626929a7d59913ae9e90aaf9
- all: start using testscript.Params.RequireExplicitExec by @mvdan in 37a2a07006fd18e751be160c2065facb9f286b54
- internal/core/adt: pick defaults for label evaluation by @mpvl in 83d37e79367ee589d797787b7328ab17a14d39e6
- cmd/cue/cmd: testscript moved its gopath location by @mvdan in 4a73630583dbb4c4708502de9d275b59fae13d20
- internal/core/adt: SpawnRef loop optimization by @rogpeppe in 7292034f3ba2c7ea0fb3df4d2c40b5c643c46ac4
- all: use txtar filename extensions consistently by @mvdan in c1689bb0513916bb39709ba7eac6c889949c07a9
- mod: drop x/xerrors from the module graph by @mvdan in 0460b47b66065f415a76c96672c55b4d32ae1f49
- mod: drop apd v1 from the module graph by @mvdan in d663a8c62f8540abd656f32745a3875f499f565d
- all: apply Go 1.19's gofmt by @mvdan in 3f3f18168373298c1580006de52303e06135fcc8
- internal/core/adt: fix spurious cycle by @mpvl in e187f9fe5d456f14073645670a98803d3048849e
- internal/core/adt: reimplementation of cycle algorithm by @mpvl in 6b3fd657900412db28bc4270aa0bd31d12fa3c48
- internal/core/adt: hoist cycle logic by @mpvl in eab8c8ea5c60ce284b4297ca707fa91cbce11b59
- internal/core/adt: pass Conjunct instead of Environment to Resolve by @mpvl in 428d3955064ca586fd855d4505ab4fe2cf7163f7
- internal/core/adt: don't spawn duplicate locations by @mpvl in 3bedf8ea89bed806257bb62f56cced9dbb993c30
- internal/core/adt: fix env linking for comprehensions by @mpvl in b00f5d6beac35769cc101e3e4e60894c88a0e2f1
- cmd/cue: remove all stdin buffering by @mvdan in b4d1b16ccf8944599eec6870da400d2b56da979b
- all: use the .test TLD for module paths in tests by @mvdan in 5a08d2f7a9a7595def05c5486cbb5276e66391cb
- CI: only pull master commits through a proxy on Linux by @mvdan in 395df20f0fe6983b18ca30f03f1c5caa6d144ca3
- CI: try "pull through proxy" go get up to five times by @mvdan in 4f150368159fdb18df5d5fc3306b6598b8ca9ac9
- all: fix migration to x/tools/txtar by @myitcv in 0a46a1624353da7327d356040a5612251e01659f
- cmd/cue/cmd: add --inline-imports flag by @mpvl in 974a09bb69aaf6b4d22f3a6e6a6929d7e306c605
- cue: support InlineImports for Syntax by @mpvl in ae56267956abf38f79b66fc9809d61abab0a50d1
- internal/core/export: don't inline for errors by @mpvl in e87bc251364ca2ac93055befed518207771bc660
- internal/core/export: enhancements for import inlining by @mpvl in 62fedc345677e3205bbbe23e8f2a99223ab5fa21
- internal/core/export: implement self-contained algo for export by @mpvl in c71f6745235d5d2dc48ad044d93efc50485fdd7a
- all: fix common pattern of calling cuextxtar.Load by @myitcv in bdaadc9c872bd204940e41e15ec1dc5fb2378f13
- pkg/tool/cli: rework Stdin and make Ask read an entire line by @mvdan in 4432aa66244b1c704143327709741edfc803cc82
- all: swap rogpeppe/go-internal/txtar for x/tools/txtar by @mvdan in 9f3d9d204ffe2e26ff4a104406b585df0d42023c
- internal/ci: use consistent name for CUELANGORGTIPREBUILDHOOK by @myitcv in a9f8bd2e84e4b76f8bff33d05856c19269f2d314
- cmd/cue/cmd: remove bits of unused code by @mvdan in 4d7edeb14282847c88d36ce02e1a2852279352c2
- internal/diff: two different errors are equal by @mpvl in 6e95220b64bffd37f1a4aee40054aa0d010fa2c1
- interal/diff: skip hidden fields by default by @mpvl in 5151417cdd411a470585149041d6bcb72793b841
- .gitignore: ignore some binaries by @mpvl in 2d10d0f19cff3eff21f5bc20d9203610ff775b5d
- internal/core/export: cleanup of initialization and finalize by @mpvl in 8a7ebf930b080ab9d14d8d23755d2ec39d1194b1
- internal/core/export: simplify dynamic labels by @mpvl in 8edd739a9501e2198e5b171158786ebb34ed6477
- internal/core/export: refactor uniqueFeature by @mpvl in 9777511749aef21ffdc2addf79ad9f7738b0baab
- internal/core/export: fix bug exporting dynamic references by @mpvl in 360ef5f88bfd0caa06b4db3d4e21e88b9d264032
- internal/core/adt: clarify examples for references by @mpvl in 5cb52c862ffacc20e4d56c2d14dfa4e112be204c
- internal/core/export: hoist FieldReference logic by @mpvl in 82a25134453d2ae49dde27edb49ebe37b50491d6
- internal/core/export: pass Environment by @mpvl in 254d0ded1cdcd614304a53082bc5296fe1ac1daa
- internal/core/export: move tests to subdir by @mpvl in 08c06896d5d3c5f4378f5ab5c357b03d041a1d3b
- tools/fix: remove rewriting support for old-style let by @mpvl in 9a66c51a1bd05277605e15690881f08793d50212
- internal/core/export: hoist reference logic by @mpvl in 580edf46b0f30089e8b4f4594a49a16354237d89
- cue/format: fix `StructLit` trailing comma bug by @satotake in d16c7998541098bb304910add474bfb76308db96
- internal/ci/github: skip non-race tests when running race tests by @myitcv in 4113ec34607a913703694b8a4c4996ffb4552d92
- internal/ci: refactor CI workflows by @myitcv in 236a565379907bc92997645e4113ca1ed6c499b6
- internal/ci: split github workflows into separate files by @myitcv in 9d366cd68db61d461d752db8d649734ba08bd7fa
- internal/ci: write netrc file for triggering trybots by @myitcv in 62ccbc0f983c3e6abdd786a6f2342b4f7b46d6c4
- internal/ci: move to using gerritstatusupdater by @myitcv in f28ad41e9ed5918933123c17bab0dd62614c7399
- internal/ci: rename test and repository_dispatch workflows by @myitcv in d4526fe916326dc69e216864d936e26ce7aef2bb
- cuego: fix example in docs by @rogpeppe in 2fea90a631b14946ca0ffac025e64da2d09d3e27
- internal/ci: move workflow declarations to their own package by @myitcv in 2795dcc4db87bb3355de0a49d6596c87f9c2e3d4
- cue/load: actually apply the latest doc wording per the reviews by @mvdan in f32ea8e85e21e7472b0ca6ca1f6aa526a3650d65
- cue/load: remove old reference to a "query tool" by @mvdan in 03ed417512087bc72e9af50ab14a1a5e336a91b9
- internal/ci: stop using txtar tests for GitHub actions workflows by @myitcv in 18762768e25c6b8ad1da50af250cebe640e82c92
- cmd/cue: support buildinfo in version sub-command by @djosephsen in b8703c81a42138361e24e76ea989e7c8b7c03d18
- doc/spec: minor adjustments after a careful read by @mvdan in cf3ba23211d397d7232e531090d7074146d4bbbd
- pkg/gen: remove unreachable code by @rogpeppe in 2f05fc92404e0c47dd62c8f769c8881f87ae9bec
- pkg/gen: generate (almost) all pkg.go files in one call by @rogpeppe in 23dc354ff7ad0ed477a733f6d04866d12f5f9330
- all: use go-cmp.Diff more consistently by @mvdan in b30eb998836590adaa22abdd5f628aaddb0fb0cb
- cmd/cue: use `cue` in test scripts rather than `exec cue` by @mvdan in 621f437aef4f344582476f4b6731c906d6160de5
- internal/core/adt: remove stutter in error by @mpvl in 41ceff3c78eb0ed13e60c673a6a4b002366d473d
- internal/core/adt: keep arc on comprehension error by @mpvl in 309f8e7b1ac5bed017b6b4b8f6dc8e1e512b8614
- internal/core/adt: use per-field comprehensions by @mpvl in 748a68589747fed6273d6338eb7e275a4fb116c6
- cmd/cue/cmd: remove usage of cue.Runtime by @mpvl in 0b0f1d30c967172b69df59f869156f3d154d9cc3
- tools/flow: get rid of deprecated cue.Runtime by @mpvl in 3ac85dc3ca89ff621150aad1b50fb736ea0b5f9f
- internal/core/adt: move closedness check by @mpvl in abd2ba347d8d706c7ae371c7d0c19ba7f102ff33
- internal/core/adt: prepare for comprehension change by @mpvl in 38b5fe26c487becef1e2cab6267e4f05b85175ec
- internal/core/adt: remove redundant indirection by @mpvl in 5201fde5ac039dd9c87290cd8382796d5aa3189e
- internal/core/adt: add convenience logging method by @mpvl in ee36170a79613b52933fe8122e6531918950aba5
- internal/encoding: always validate when exporting by @qequ in 5b8860ae5306b51bf38e7ea4b6e536a7477cff29
- cue/pkg/strconv: support arbitary-precision format by @satotake in 9bda22051dd8d9dbe1539e6b2f7205512e64f303
- pkg/internal: make it clearer that const is exclusive to func by @rogpeppe in e77a8790de2b2e7e9bed632594de0e0cf14521fa
- cue/format: escape tabs when printing comments, literals, and attributes by @mvdan in dac491717c1e21e40b0fbd5030ac2435507353d7
- all: replace filepath.Walk with WalkDir by @mvdan in 79b324d14be06b57bcd0a4644fb28155bd8267c7
- cmd/cue: initialize toTop and toString without go/packages by @mvdan in 0f66c58a0ae826040fa35461ae8567aba6f5c327
- doc/contribute.md: simplify code backticks by @rytswd in 193e320762afa09334d4514883f3a95a15ced2fa
- internal/ci: avoid merge commits when testing GitHub PRs by @mvdan in 6de1c17620c78a19bf78d64498bc248b79ce82cc
- internal/encoding/yaml: update dependencies by @myitcv in ef1b8aaa282a263b8634d7333bdb01868ff4e7f0
- encoding/protobuf: update dependencies by @mvdan in 31be9e32f88c1442cfe0e5f2cdb546ad89ee2415
- Revert "all: avoid using too many packages.Need bits" by @mvdan in 87408d7d0c61bf6ff2711fd202727639aac97290
- all: avoid using too many packages.Need bits by @mvdan in aa9b1bd076a6b54fcdcef92838f73c982a356d67
- all: fix a few more staticcheck nits by @mvdan in 92b9a06a99a7e27eaf91345545c75054c6279342
- cmd/cue: remove the need for embedpkg by @mvdan in 89c6cdc1973da4edd97918bca19d959970f616a8
- all: make use of t.TempDir and t.Setenv by @mvdan in 6634a00a80472ff0204427592b5d24f94fd55fc9
- pkg/strconv: Revert "pkg/strconv: allow string argument for format" by @rogpeppe in 1ed6195cd8d0051bb2a59c68be8d6a9234ea7138
- pkg/strconv: allow string argument for format by @rogpeppe in 053c4acc845c1726aca9e7974112d9bf296892c7
- internal/core: comment improvements by @rogpeppe in 34782fe0bb8cb65b5dda49c377d24089cb131987
- cue/literal: allow escaped newlines in multiline strings by @rogpeppe in 618e5301ec0a5875d1b95d06800a4962c150d857
- all: drop support for Go 1.16.x by @mvdan in bd9ae5371cc23c54cb3cb90c0bd5a1fa4d82bc92
- all: make vet happy by @mvdan in a58ac536005e7347332a26c911d2c3fa43453fc9
- doc/ref: mention that newlines can be escaped in multiline strings by @rogpeppe in 13918ddeb0b0bb58ebbe92f91fd87e5d364a5844
- all: check the filepath.Walk error parameter by @mvdan in 2caf6e0f648d40b9072beb875b4ac74017ce415f
- bump x/tools and x/net dependencies by @mvdan in 79a3fa7e3eab9c18cab54f376cfa24600489e319
- all: fix a few minor typos spotted by gospel by @mvdan in 78815882e5f3234873f4ca4774e2919f27b594c0
- cue/scanner: allow leading double-quote in #-quoted string by @rogpeppe in db398ad39a34334a3431c66d504a0f9929faf55a
- internal/ci: remove gorelease check step by @mvdan in c942d0afb0e7d38468328fad387a524403cd9799
- internal/ci: enforce Signed-off-by temporarily by @mvdan in 7dd325d2690f84331c5ff8d5636f1bf4d520236e
- all: remove redundant interface type assertions by @mvdan in 74d55b75af75f803103e9e24408f2521b936b41d
- pkg/list/sort: fix syntax in docs by @tmm1 in 00c5ddf5e4ed1781cbf07b9b941a1c7c36a62d87
- internal/ci: bump GitHub Actions OS versions by @mvdan in db3e6ace8c735f5bb05b1e13a7acfd7d8b72726b
- cmd/cue: remove duplicate files from get_go_types.txt by @mvdan in eb0a4ff1aee987da38e528240533ba89af738c8a
- internal/cuetest: drive long tests via an env var by @mvdan in 33b18be9eddd72ea356a913117bb1327a04242fd
- cmd/cue: import -R: don't treat text with no newlines as YAML by @rogpeppe in f207b0b9285ad043221ff9f3c2207d04e8c32cc0
- cmd/cue: better test for import --recursive by @rogpeppe in 7f3c0a2b435d8597a4378fb56a07e5afe2847b35
