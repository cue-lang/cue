#IgnoreConcrete: true
#InferTasks: true
-- in.cue --
package x

root: {
	prepare: {
		$id: "prepare"
		stdout: string
	}
	env2: {
		// Note: the string interpolation here is the only difference
		// from issue2517.txtar. It makes the value incomplete
		// rather than just non-concrete.
		input: "\(prepare.stdout)"
	}
	run: {
		$id: "run"
		env: env2
	}
}
-- out/run/errors --
-- out/run/t0 --
graph TD
  t0("root.prepare [Ready]")
  t1("root.run [Waiting]")
  t1-->t0

-- out/run/t1 --
graph TD
  t0("root.prepare [Terminated]")
  t1("root.run [Ready]")
  t1-->t0

-- out/run/t1/value --
{
	$id:    "prepare"
	stdout: "foo"
}
-- out/run-v3/t1/stats --
Leaks:  0
Freed:  10
Reused: 3
Allocs: 7
Retain: 0

Unifications: 10
Conjuncts:    15
Disjuncts:    0
ResolveDep:   2

NumCloseIDs: 1
-- diff/-out/run-v3/t1/stats<==>+out/run/t1/stats --
diff old new
--- old
+++ new
@@ -1,9 +1,12 @@
 Leaks:  0
-Freed:  11
-Reused: 6
-Allocs: 5
+Freed:  10
+Reused: 3
+Allocs: 7
 Retain: 0
 
-Unifications: 11
-Conjuncts:    17
-Disjuncts:    11
+Unifications: 10
+Conjuncts:    15
+Disjuncts:    0
+ResolveDep:   2
+
+NumCloseIDs: 1
-- out/run/t1/stats --
Leaks:  0
Freed:  11
Reused: 6
Allocs: 5
Retain: 0

Unifications: 11
Conjuncts:    17
Disjuncts:    11
-- out/run/t2 --
graph TD
  t0("root.prepare [Terminated]")
  t1("root.run [Terminated]")
  t1-->t0

-- out/run/t2/value --
{
	$id: "run"
	env: {
		input: "foo"
	}
	stdout: "foo"
}
-- out/run-v3/t2/stats --
Leaks:  0
Freed:  11
Reused: 10
Allocs: 1
Retain: 0

Unifications: 11
Conjuncts:    19
Disjuncts:    0
ResolveDep:   4

NumCloseIDs: 1
-- diff/-out/run-v3/t2/stats<==>+out/run/t2/stats --
diff old new
--- old
+++ new
@@ -1,9 +1,12 @@
 Leaks:  0
-Freed:  12
-Reused: 12
-Allocs: 0
+Freed:  11
+Reused: 10
+Allocs: 1
 Retain: 0
 
-Unifications: 12
-Conjuncts:    22
-Disjuncts:    12
+Unifications: 11
+Conjuncts:    19
+Disjuncts:    0
+ResolveDep:   4
+
+NumCloseIDs: 1
-- out/run/t2/stats --
Leaks:  0
Freed:  12
Reused: 12
Allocs: 0
Retain: 0

Unifications: 12
Conjuncts:    22
Disjuncts:    12
-- out/run-v3/stats/totals --
Leaks:  0
Freed:  21
Reused: 13
Allocs: 8
Retain: 0

Unifications: 21
Conjuncts:    34
Disjuncts:    0
ResolveDep:   6

NumCloseIDs: 2
-- diff/-out/run-v3/stats/totals<==>+out/run/stats/totals --
diff old new
--- old
+++ new
@@ -1,9 +1,12 @@
 Leaks:  0
-Freed:  23
-Reused: 18
-Allocs: 5
+Freed:  21
+Reused: 13
+Allocs: 8
 Retain: 0
 
-Unifications: 23
-Conjuncts:    39
-Disjuncts:    23
+Unifications: 21
+Conjuncts:    34
+Disjuncts:    0
+ResolveDep:   6
+
+NumCloseIDs: 2
-- out/run/stats/totals --
Leaks:  0
Freed:  23
Reused: 18
Allocs: 5
Retain: 0

Unifications: 23
Conjuncts:    39
Disjuncts:    23
